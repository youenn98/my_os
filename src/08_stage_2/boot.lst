     1                                  BOOT_LOAD equ 0x7C00        ;ÂêØÂä®Á®ãÂ∫èÁöÑÂä†ËΩΩ‰ΩçÁΩÆ
     2                                  
     3                                  ORG BOOT_LOAD               ;ÂêëÁºñËØëÂô®ÊåáÁ§∫Âä†ËΩΩÂú∞ÂùÄ
     4                                  
     5                                  ;**************************
     6                                  ; ÂÆèËÆæÂÆö
     7                                  ;*************************
     8                                  %include "../include/macro.s"
     1                              <1> %macro cdecl 1-*.nolist  ;//1-* «“ª∏ˆ“‘…œµƒ≤Œ ˝
     2                              <1> 
     3                              <1> 	%rep %0 - 1         ;//%0 «≤Œ ˝µƒ∏ˆ ˝
     4                              <1> 		push %{-1:-1}  ;//%Ω´≤Œ ˝µπ◊≈—π’ª
     5                              <1> 		%rotate -1   
     6                              <1> 	%endrep
     7                              <1> 	%rotate -1      ;//ª÷∏¥‘≠¿¥µƒ≤Œ ˝
     8                              <1> 
     9                              <1> 	call %1
    10                              <1> 	%if 1 < %0
    11                              <1> 		add sp,(__BITS__ >> 3)*(%0 - 1)     ;//__BITS__ «±Ì æ16±»Ãÿƒ£ Ωªπ «32±»Ãÿƒ£ Ω
    12                              <1> 	%endif									;//∏¯√ø∏ˆ≤Œ ˝∑÷≈‰’ªø’º‰
    13                              <1> 
    14                              <1> %endmacro
     9                                  
    10                                  
    11                                  entry:
    12 00000000 EB58                    	jmp ipl
    13                                  	;------------------
    14                                  	;BPB(BIOS Parameter Block)
    15                                  	;------------------
    16 00000002 90<rept>                	times 90 -($-$$) db 0x90
    17                                  
    18                                  	;----------------------------
    19                                  	;IPL(Initial Pragram Loader)
    20                                  	;----------------
    21                                  ipl:
    22 0000005A FA                      	cli ;//Á¶ÅÊ≠¢‰∏≠Êñ≠
    23                                  
    24 0000005B B80000                  	mov ax,0x0000
    25 0000005E 8ED8                    	mov ds , ax        ;//Â∞ÜÊÆµÂØÑÂ≠òÂô®ÈÉΩÂÖàËÆæÁΩÆ‰∏∫0
    26 00000060 8EC0                    	mov es , ax
    27 00000062 8ED0                    	mov ss , ax
    28 00000064 BC007C                  	mov sp , BOOT_LOAD   ;//Â∞ÜÊ†àÂ∫ïËÆæÁΩÆ‰∏∫bootÁ®ãÂ∫èÂºÄÂßãÁöÑÂú∞Êñπ
    29                                  
    30 00000067 FB                      	sti ;//ÂÖÅËÆ∏‰∏≠Êñ≠
    31                                  
    32 00000068 8816[AE00]              	mov [BOOT.DRIVE], dl;//dlÊòØ‰øùÂ≠òÂêØÂä®Á®ãÂ∫èÁöÑÂ§ñÈÉ®ËÆæÂ§áÁöÑÂ∫èÂè∑
    33                                  	;-------------------
    34                                  	;ËØªÂèñÊé•‰∏ãÊù•ÁöÑ512Â≠óËäÇ
    35                                  	;-------------------
    36                                  	
    37 0000006C B402                    	mov ah,0x02  ;//ËØªÂèñÂëΩ‰ª§
    38 0000006E B001                    	mov al,1	;//ËØªÂèñÁöÑsectorÊï∞
    39 00000070 B90200                  	mov cx, 0x0002 ;// clinder/sector
    40 00000073 B600                    	mov dh, 0x00   ;// head
    41 00000075 8A16[AE00]              	mov dl, [BOOT.DRIVE] ;//È©±Âä®ÁºñÂè∑
    42 00000079 BB007E                  	mov bx, 0x7C00 + 512 ;//offset
    43 0000007C CD13                    	int 0x13
    44 0000007E 730C                    .10Q: jnc .10E
    45 00000080 68[9C00]E82A0083C4-     .10T: cdecl puts, .e0 ;//ÂèëÁîüÈîôËØØ
    45 00000088 02                 
    46 00000089 E84300                  	call reboot      ;//ÈáçÂêØ
    47                                  
    48                                  .10E:
    49 0000008C E97101                  	jmp stage_2    ;//ÂêØÂä®Á®ãÂ∫èÁ¨¨‰∫å‰ΩçÁΩÆ
    50                                  
    51 0000008F 426F6F74696E672E2E-     .s0 db "Booting...",0x0A,0x0D,0 ;//0x0AÊòØ‰∏ã‰∏ÄË°å,0x0DÊòØÂ∞ÜkernelÁßªÂà∞ÊúÄÂ∑¶Á´Ø,0‰ª£Ë°®Â≠óÁ¨¶‰∏≤ÁöÑÁªàÁªì
    51 00000098 2E0A0D00           
    52 0000009C 4572726F723A736563-     .e0 db "Error:sector read",0 ;//ÈîôËØØ‰ø°ÊÅØ
    52 000000A5 746F72207265616400 
    53                                  
    54                                  ALIGN 2, db 0
    55                                  BOOT:
    56 000000AE 0000                    .DRIVE: dw 0   ;//driveÁöÑÂ∫èÂè∑
    57                                  
    58                                  ;**********************
    59                                  ;module
    60                                  ;***********************
    61                                  %include "../modules/real/puts.s"
     1                              <1> puts:
     2 000000B0 55                  <1> 	push bp
     3 000000B1 89E5                <1> 	mov bp,sp
     4                              <1> 
     5 000000B3 50                  <1> 	push ax
     6 000000B4 53                  <1> 	push bx
     7 000000B5 56                  <1> 	push si
     8                              <1> 
     9                              <1> 	;**************
    10                              <1> 	;»°µ√◊÷∑˚¥Æµƒø™ ºµÿ÷∑
    11                              <1> 	;**************
    12 000000B6 8B7604              <1> 	mov si,[bp+4]
    13                              <1> 
    14 000000B9 B40E                <1> 	mov ah,0x0E
    15 000000BB BB0000              <1> 	mov bx,0x0000
    16 000000BE FC                  <1> 	cld    ;//DF = 0 µÿ÷∑µ›‘ˆ
    17                              <1> 
    18                              <1> .10L:
    19                              <1> 	
    20 000000BF AC                  <1> 	lodsb ;//AL = *SI++
    21                              <1> 
    22 000000C0 3C00                <1> 	cmp al,0	;//if(AL == 0)
    23 000000C2 7404                <1> 	je	.10E	;//breal
    24                              <1> 
    25 000000C4 CD10                <1> 	int 0x10
    26 000000C6 EBF7                <1> 	jmp .10L
    27                              <1> .10E:
    28                              <1> 
    29 000000C8 5E                  <1> 	pop si
    30 000000C9 5B                  <1> 	pop bx
    31 000000CA 58                  <1> 	pop ax
    32                              <1> 
    33 000000CB 89EC                <1> 	mov sp,bp
    34 000000CD 5D                  <1> 	pop bp
    35                              <1> 
    36 000000CE C3                  <1> 	ret
    62                                  %include "../modules/real/reboot.s"
     1                              <1> reboot:
     2                              <1> 	;---------------------
     3                              <1> 	;±Ì æ÷ÿ∆Ù–≈œ¢
     4                              <1> 	;--------------------
     5 000000CF 68[EB00]E8DBFF83C4- <1> 	cdecl puts, .s0
     5 000000D7 02                  <1>
     6                              <1> 
     7                              <1> 	;-----------------
     8                              <1> 	;µ»¥˝ ‰»Î
     9                              <1> 	;-----------------
    10                              <1> 
    11                              <1> .10L:
    12                              <1> 	
    13 000000D8 B410                <1> 	mov ah,0x10
    14 000000DA CD16                <1> 	int 0x16
    15                              <1> 
    16 000000DC 3C00                <1> 	cmp al,''  ;//»Áπ˚ª∫≥Â«¯”– ˝æ›,µ»¥˝”√ªß ‰»Îªÿ≥µ
    17 000000DE 75F8                <1> 	jne .10L  
    18                              <1> 
    19                              <1> 	;------------------------------
    20                              <1> 	;ªª––
    21                              <1> 	;-----------------------------
    22                              <1> 
    23 000000E0 68[0901]E8CAFF83C4- <1> 	cdecl puts, .s1
    23 000000E8 02                  <1>
    24                              <1> 
    25 000000E9 CD19                <1> 	int 0x19 ;//÷ÿ∆Ù
    26                              <1> 
    27 000000EB 0A0D50555348205350- <1> .s0 db 0x0A,0x0D,"PUSH SPACE key to reboot...",0x0A
    27 000000F4 414345206B65792074- <1>
    27 000000FD 6F207265626F6F742E- <1>
    27 00000106 2E2E0A              <1>
    28 00000109 0A0D0A0D00          <1> .s1 db 0x0A,0x0D,0x0A,0x0D,0
    63                                  
    64                                  ;******************
    65                                  ;boot_flag
    66                                  ;*******************
    67 0000010E 00<rept>                	times 510 -($-$$) db 0x00
    68 000001FE 55AA                    	db 0x55,0xAA
    69                                  
    70                                  ;*********************
    71                                  ;bootÂ§ÑÁêÜÁöÑÁ¨¨‰∫åÈò∂ÊÆµ
    72                                  ;*********************
    73                                  stage_2:
    74 00000200 68[0B02]E8AAFE83C4-     	cdecl puts, .s0
    74 00000208 02                 
    75                                  
    76                                  	;-----------------
    77                                  	;Â§ÑÁêÜÁªìÊùü
    78                                  	;---------------;
    79                                  
    80 00000209 EBFE                    	jmp $
    81 0000020B 326E64207374616765-     .s0 db "2nd stage...",0X0A,0x0D,0
    81 00000214 2E2E2E0A0D00       
    82                                  
    83                                  ;**********************
    84                                  ;padding
    85                                  ;**********************
    86 0000021A 00<rept>                	times (1024 * 8)-($-$$) db 0;    8KB
