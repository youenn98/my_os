     1                                  BOOT_LOAD equ 0x7C00        ;ÂêØÂä®Á®ãÂ∫èÁöÑÂä†ËΩΩ‰ΩçÁΩÆ
     2                                  
     3                                  ORG BOOT_LOAD               ;ÂêëÁºñËØëÂô®ÊåáÁ§∫Âä†ËΩΩÂú∞ÂùÄ
     4                                  
     5                                  ;**************************
     6                                  ; ÂÆèËÆæÂÆö
     7                                  ;*************************
     8                                  %include "../include/macro.s"
     1                              <1> %macro cdecl 1-*.nolist  ;//1-* «“ª∏ˆ“‘…œµƒ≤Œ ˝
     2                              <1> 
     3                              <1> 	%rep %0 - 1         ;//%0 «≤Œ ˝µƒ∏ˆ ˝
     4                              <1> 		push %{-1:-1}  ;//%Ω´≤Œ ˝µπ◊≈—π’ª
     5                              <1> 		%rotate -1   
     6                              <1> 	%endrep
     7                              <1> 	%rotate -1      ;//ª÷∏¥‘≠¿¥µƒ≤Œ ˝
     8                              <1> 
     9                              <1> 	call %1
    10                              <1> 	%if 1 < %0
    11                              <1> 		add sp,(__BITS__ >> 3)*(%0 - 1)     ;//__BITS__ «±Ì æ16±»Ãÿƒ£ Ωªπ «32±»Ãÿƒ£ Ω
    12                              <1> 	%endif									;//∏¯√ø∏ˆ≤Œ ˝∑÷≈‰’ªø’º‰
    13                              <1> 
    14                              <1> %endmacro
     9                                  
    10                                  
    11                                  entry:
    12 00000000 EB58                    	jmp ipl
    13                                  	;------------------
    14                                  	;BPB(BIOS Parameter Block)
    15                                  	;------------------
    16 00000002 90<rept>                	times 90 -($-$$) db 0x90
    17                                  
    18                                  	;----------------------------
    19                                  	;IPL(Initial Pragram Loader)
    20                                  	;----------------
    21                                  ipl:
    22 0000005A FA                      	cli ;//Á¶ÅÊ≠¢‰∏≠Êñ≠
    23                                  
    24 0000005B B80000                  	mov ax,0x0000
    25 0000005E 8ED8                    	mov ds , ax        ;//Â∞ÜÊÆµÂØÑÂ≠òÂô®ÈÉΩÂÖàËÆæÁΩÆ‰∏∫0
    26 00000060 8EC0                    	mov es , ax
    27 00000062 8ED0                    	mov ss , ax
    28 00000064 BC007C                  	mov sp , BOOT_LOAD   ;//Â∞ÜÊ†àÂ∫ïËÆæÁΩÆ‰∏∫bootÁ®ãÂ∫èÂºÄÂßãÁöÑÂú∞Êñπ
    29                                  
    30 00000067 FB                      	sti ;//ÂÖÅËÆ∏‰∏≠Êñ≠
    31                                  
    32 00000068 8816[2601]              	mov [BOOT.DRIVE], dl;//dlÊòØ‰øùÂ≠òÂêØÂä®Á®ãÂ∫èÁöÑÂ§ñÈÉ®ËÆæÂ§áÁöÑÂ∫èÂè∑
    33                                  
    34 0000006C 68[0D01]E8B60083C4-     	cdecl puts,.s0;
    34 00000074 02                 
    35 00000075 6A016A0A6A0868-         	cdecl itoa ,8086,.s1,8,10,0b0001	;//" 8086"
    35 0000007C [1A01]68961FE8C300-
    35 00000084 83C40A             
    36                                  
    37 00000087 6A036A0A6A0868-         	cdecl itoa ,8086,.s1,8,10,0b0011	;//"+ 8086"
    37 0000008E [1A01]68961FE8B100-
    37 00000096 83C40A             
    38 00000099 68[1A01]E8890083C4-     	cdecl puts ,.s1
    38 000000A1 02                 
    39                                  
    40 000000A2 6A016A0A6A0868-         	cdecl itoa ,-8086, .s1,8,10,0b0001	;//"- 8086"
    40 000000A9 [1A01]686AE0E89600-
    40 000000B1 83C40A             
    41 000000B4 68[1A01]E86E0083C4-     	cdecl puts ,.s1
    41 000000BC 02                 
    42                                  
    43 000000BD 6A016A0A6A0868-         	cdecl itoa ,-1, .s1,8,10,0b0001	;//" -1"
    43 000000C4 [1A01]6AFFE87C0083-
    43 000000CC C40A               
    44 000000CE 68[1A01]E8540083C4-     	cdecl puts ,.s1
    44 000000D6 02                 
    45                                  
    46 000000D7 6A006A0A6A0868-         	cdecl itoa ,-1, .s1,8,10,0b0000	;//" 65535"
    46 000000DE [1A01]6AFFE8620083-
    46 000000E6 C40A               
    47 000000E8 68[1A01]E83A0083C4-     	cdecl puts ,.s1
    47 000000F0 02                 
    48                                  
    49 000000F1 6A006A106A0868-         	cdecl itoa ,-1, .s1,8,16,0b0000	;//" FFFF"
    49 000000F8 [1A01]6AFFE8480083-
    49 00000100 C40A               
    50 00000102 68[1A01]E8200083C4-     	cdecl puts ,.s1
    50 0000010A 02                 
    51                                  
    52                                  	;//cdecl itoa ,12, .s1,8,2,0b0001	;//" 00001100"
    53                                  	;//cdecl puts ,.s1
    54                                  
    55 0000010B EBFE                    	jmp $
    56                                  
    57 0000010D 426F6F74696E672E2E-     .s0 db "Booting...",0x0A,0x0D,0 ;//0x0AÊòØ‰∏ã‰∏ÄË°å,0x0DÊòØÂ∞ÜkernelÁßªÂà∞ÊúÄÂ∑¶Á´Ø,0‰ª£Ë°®Â≠óÁ¨¶‰∏≤ÁöÑÁªàÁªì
    57 00000116 2E0A0D00           
    58 0000011A 2D2D2D2D2D2D2D2D0A-     .s1 db "--------",0x0A,0x0D,0 ;//Êï∞ÂÄºÂ≠óÁ¨¶‰∏≤ÁöÑÁºìÂ≠òÁ©∫Èó¥
    58 00000123 0D00               
    59                                  
    60 00000125 00                      ALIGN 2, db 0
    61                                  BOOT:
    62 00000126 0000                    .DRIVE: dw 0   ;//driveÁöÑÂ∫èÂè∑
    63                                  
    64                                  ;**********************
    65                                  ;module
    66                                  ;***********************
    67                                  %include "../modules/real/puts.s"
     1                              <1> puts:
     2 00000128 55                  <1> 	push bp
     3 00000129 89E5                <1> 	mov bp,sp
     4                              <1> 
     5 0000012B 50                  <1> 	push ax
     6 0000012C 53                  <1> 	push bx
     7 0000012D 56                  <1> 	push si
     8                              <1> 
     9                              <1> 	;**************
    10                              <1> 	;»°µ√◊÷∑˚¥Æµƒø™ ºµÿ÷∑
    11                              <1> 	;**************
    12 0000012E 8B7604              <1> 	mov si,[bp+4]
    13                              <1> 
    14 00000131 B40E                <1> 	mov ah,0x0E
    15 00000133 BB0000              <1> 	mov bx,0x0000
    16 00000136 FC                  <1> 	cld    ;//DF = 0 µÿ÷∑µ›‘ˆ
    17                              <1> 
    18                              <1> .10L:
    19                              <1> 	
    20 00000137 AC                  <1> 	lodsb ;//AL = *SI++
    21                              <1> 
    22 00000138 3C00                <1> 	cmp al,0	;//if(AL == 0)
    23 0000013A 7404                <1> 	je	.10E	;//breal
    24                              <1> 
    25 0000013C CD10                <1> 	int 0x10
    26 0000013E EBF7                <1> 	jmp .10L
    27                              <1> .10E:
    28                              <1> 
    29 00000140 5E                  <1> 	pop si
    30 00000141 5B                  <1> 	pop bx
    31 00000142 58                  <1> 	pop ax
    32                              <1> 
    33 00000143 89EC                <1> 	mov sp,bp
    34 00000145 5D                  <1> 	pop bp
    35                              <1> 
    36 00000146 C3                  <1> 	ret
    68                                  %include "../modules/real/itoa.s"
     1                              <1> itoa:
     2                              <1> 		;	+12|∑˚∫≈
     3                              <1> 		;	+10|ª˘ ˝
     4                              <1> 		;	+8 |ª∫¥Êµƒ¥Û–°
     5                              <1> 		;	+6 |ª∫¥Êµƒµÿ÷∑
     6                              <1> 		;	+4 | ˝÷µ
     7                              <1> 		;	+2 |IP (∑µªÿµÿ÷∑)
     8                              <1> 		; BP+0 | ‘≠¿¥µƒBP
     9                              <1> 
    10 00000147 55                  <1> 	push bp
    11 00000148 89E5                <1> 	mov bp,sp
    12                              <1> 
    13 0000014A 50                  <1> 	push ax
    14 0000014B 53                  <1> 	push bx
    15 0000014C 51                  <1> 	push cx
    16 0000014D 52                  <1> 	push dx
    17 0000014E 56                  <1> 	push si
    18 0000014F 57                  <1> 	push di
    19                              <1> 
    20                              <1> 
    21 00000150 8B4604              <1> 	mov ax,[bp + 4] ;//ax =  ˝÷µ
    22 00000153 8B7606              <1> 	mov si,[bp + 6] ;//si = ª∫¥Êµÿ÷∑
    23 00000156 8B4E08              <1> 	mov cx,[bp + 8] ;//cx = ª∫¥Êµÿ÷∑»›¡ø
    24 00000159 89F7                <1> 	mov di , si	  ;//di = ª∫¥Êµƒ◊Ó∫Û
    25 0000015B 01CF                <1> 	add di , cx
    26 0000015D 4F                  <1> 	dec di
    27                              <1> 
    28 0000015E 8B5E0C              <1> 	mov bx,word[bp+12] ;//bx = flag
    29                              <1> 
    30                              <1> 	;--------------
    31                              <1> 	;≈–∂œ «∑Ò «”–∑˚∫≈ ˝
    32                              <1> 	;--------------
    33 00000161 F7C30100            <1> 	test bx,0b0001   ;//(bx&0x01) »Áπ˚◊Ó∫Û“ªŒª «1,Àµ√˜ «¥¯∑˚∫≈µƒ
    34 00000165 7408                <1> .10Q: je .10E       
    35 00000167 83F800              <1> 	 cmp ax,0        ;//»Áπ˚ ax < 0
    36 0000016A 7D03                <1> .12Q: jge  .12E
    37 0000016C 83CB02              <1> 	or   bx,0b0010  ;//±Ì æ∑˚∫≈
    38                              <1> .12E:
    39                              <1> .10E:
    40                              <1> 
    41                              <1> 
    42                              <1> 	;-------------------
    43                              <1> 	;≈–∂® ‰≥ˆ ≤√¥∑˚∫≈
    44                              <1> 	;--------------------
    45 0000016F F7C30200            <1> 	test bx,0b0010 ;//(bx&0x02) »Áπ˚ «≤ª «0,‘ÚÀµ√˜–Ë“™…Ë÷√∑˚∫≈
    46 00000173 7410                <1> .20Q: je .20E
    47 00000175 83F800              <1> 	 cmp ax,0
    48 00000178 7D07                <1> .22Q: jge .22F
    49 0000017A F7D8                <1> 	neg ax
    50 0000017C C6042D              <1> 	mov [si],byte'-'
    51 0000017F EB03                <1> 	jmp .22E
    52                              <1> .22F:
    53                              <1> 
    54 00000181 C6042B              <1> 	mov  [si],byte'+'
    55                              <1> .22E:
    56 00000184 49                  <1> 	dec cx   ;//size--
    57                              <1> 
    58                              <1> .20E:
    59                              <1> 
    60                              <1> 	;---------------------
    61                              <1> 	;ASCII±‰ªª
    62                              <1> 	;--------------------
    63 00000185 8B5E0A              <1> 	mov bx,[bp+10] ;//BX = ª˘ ˝
    64                              <1> .30L:
    65                              <1> 	
    66 00000188 BA0000              <1> 	mov dx,0
    67 0000018B F7F3                <1> 	div bx      ;//dx = AX%ª˘ ˝
    68                              <1> 				;//ax = AX/ª˘ ˝
    69 0000018D 89D6                <1> 	mov si,dx
    70 0000018F 8A94[B701]          <1> 	mov dl,byte[.ascii+si] ;//dl = ASCII[DX]
    71                              <1> 
    72 00000193 8815                <1> 	mov [di],dl  ;//*dst = dl
    73                              <1> 
    74 00000195 4F                  <1> 	dec di		; dst--;
    75                              <1> 
    76 00000196 83F800              <1> 	cmp ax,0             ;
    77 00000199 E0ED                <1> 	loopnz .30L   ;//while(ax)
    78                              <1> .30E:
    79                              <1> 	
    80                              <1> 	;-------------------
    81                              <1> 	;ÃÓ¬˙ªªª∫¥Ê £”‡ø’∏Ò
    82                              <1> 	;-------------------
    83                              <1> 
    84 0000019B 83F900              <1> 	cmp cx,0  ;//»Áπ˚√ª”–ª∫¥Ê £”‡‘ÚÕÍ≥…
    85 0000019E 740D                <1> .40Q: je   .40E
    86 000001A0 B020                <1> 	  mov  al,' ' ;//ø’◊÷∑˚ÃÓ≥‰
    87 000001A2 837E0C04            <1> 	  cmp [bp+12],word 0b0100 
    88 000001A6 7502                <1> .42Q jne .42E
    89 000001A8 B030                <1> 	 mov al,'0'  ;// ”√0ÃÓ≥‰
    90                              <1> .42E:
    91 000001AA FD                  <1> 	std       ;//DF = 1 (µÿ÷∑µ›ºı)
    92 000001AB F3AA                <1> 	rep stosb    ;//while(--CX) *DI-- = al;
    93                              <1> .40E:
    94                              <1> 
    95 000001AD 5F                  <1> 	pop di
    96 000001AE 5E                  <1> 	pop si
    97 000001AF 5A                  <1> 	pop dx
    98 000001B0 59                  <1> 	pop cx
    99 000001B1 5B                  <1> 	pop bx
   100 000001B2 58                  <1> 	pop ax
   101                              <1> 
   102 000001B3 89EC                <1> 	mov sp,bp
   103 000001B5 5D                  <1> 	pop bp
   104                              <1> 
   105 000001B6 C3                  <1> 	ret
   106                              <1> 
   107 000001B7 303132333435363738- <1> .ascii db "0123456789ABCDEF"
   107 000001C0 39414243444546      <1>
    69                                  ;******************
    70                                  ;boot_flag
    71                                  ;*******************
    72 000001C7 00<rept>                	times 510 -($-$$) db 0x00
    73 000001FE 55AA                    	db 0x55,0xAA
